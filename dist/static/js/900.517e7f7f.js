"use strict";(self["webpackChunkwinktool"]=self["webpackChunkwinktool"]||[]).push([[900],{6481:function(e,t,o){o.d(t,{$l:function(){return r},Hy:function(){return c},WT:function(){return u},kC:function(){return i},kV:function(){return l},oW:function(){return s},wi:function(){return a},wv:function(){return d}});var n=o(4054);function i(e){return n.Z.get("/nftkit-web-premint-server/index/lists",e)}function a(e){return n.Z.get("/nftkit-web-premint-server/index/item",e)}function l(e){return n.Z.post("/nftkit-web-premint-server/index/item",e)}function r(e){return n.Z["delete"]("/nftkit-web-premint-server/index/item",e)}function c(e){return n.Z.post("/nftkit-web-premint-server/index/item/twitter",e)}function s(e){return n.Z.post("/nftkit-web-premint-server/index/item/register",e)}function d(e){return n.Z.post("/nftkit-web-premint-server/index/item/status",e)}function u(e){return n.Z.post("/nftkit-web-premint-server/index/item/discord",e)}},5131:function(e,t,o){o.r(t),o.d(t,{default:function(){return pe}});var n=o(8222),i=o(5452),a=o.n(i),l=o(5781),r=o(7918),c=o.n(r),s=o(5982),d=o(2966),u=o(6603),w=o(150),p=o(2024),m=o(6481),g=o(3824);const f={class:"crumbs"},k=(0,n.createElementVNode)("span",{class:"title"},"抽奖列表",-1),y={class:"table-header"},h={class:"flex pull-left"},v=(0,n.createTextVNode)(" 新增 "),N={class:"activity-details"},V={class:"options"},x=(0,n.createElementVNode)("span",{class:"label"},"类型",-1),C=(0,n.createTextVNode)("推特"),b=(0,n.createTextVNode)("喜欢和转推"),_=(0,n.createTextVNode)("Discord"),z=(0,n.createTextVNode)("钱包余额"),T=(0,n.createTextVNode)("回答问题"),E=(0,n.createTextVNode)("其他"),B={class:"pull-right flex inline-block"},S={class:"options"},L=(0,n.createElementVNode)("span",{class:"label"},"状态",-1),$={key:0,class:"mt-10 danger"},D={key:0,class:"border"},Z=(0,n.createTextVNode)(" 关注推特 "),W=["onClick"],I={key:1,class:"border"},q=(0,n.createTextVNode)(" 喜欢&转推 "),F=["onClick"],P={key:2,class:"border"},U=(0,n.createTextVNode)(" 加入Discord "),A=["onClick"],H={key:0},Y={key:3,class:"border"},j=(0,n.createTextVNode)(" 钱包需要有 "),M={key:4,class:"border"},K=(0,n.createTextVNode)(" 其他要求 "),O=(0,n.createTextVNode)("已注册"),R=(0,n.createTextVNode)("未注册"),G=(0,n.createTextVNode)(" 查看 "),J=(0,n.createTextVNode)("注册 "),Q=(0,n.createTextVNode)(" 编辑 "),X=(0,n.createTextVNode)(" 删除 "),ee=(0,n.createTextVNode)(" 标记完成 "),te={class:"table-footer"},oe={class:"select-all flex pull-left"},ne=(0,n.createTextVNode)(" 当前页全选 "),ie=(0,n.createTextVNode)("注册"),ae={class:"pagination pull-right"},le={class:"loading-mask"},re={class:"loading-spinner"},ce=(0,n.createElementVNode)("i",{class:"inner-circles-loader"},null,-1),se={class:"loading-text"},de=(0,n.createTextVNode)("取消注册");var ue=(0,n.defineComponent)({__name:"list",setup(e){const t=e=>new Promise((t=>setTimeout(t,e))),o=(0,n.getCurrentInstance)(),i=(0,n.ref)(1920),r=(0,s.Z)(),ue=new(c())(window.ethereum),we=(0,n.reactive)({currentRow:{id:""},dialogVisible:!1,dialogLoading:!1,defaultProps:{children:"children",label:"title",id:"id"},roleTree:[],listLoading:!1,keyword:"",pagination:{total:0,page:1,pageSize:10,parentId:0},lists:[],registerLoading:!1,registerLoadingText:""}),pe=(0,n.ref)([]);async function me(e){console.log(e),we.lists=[],we.pagination.page=1,we.pagination.pageSize=15,we.pagination.total=0,we.keyword="",await Te()}const ge=(0,n.ref)("not");async function fe(e){console.log(e),we.lists=[],we.pagination.page=1,we.pagination.pageSize=15,we.pagination.total=0,we.keyword="",await Te()}const ke=(0,n.computed)((()=>e=>{let t=e/1920*i.value;return t}));async function ye(){await Te()}async function he(e){we.pagination.pageSize=e,await Te()}async function ve(e){we.pagination.page=e,await Te()}function Ne(e){nw.Window.open(e,{width:640,height:480},(function(e){}))}async function Ve(e){a().empty(e.discord?.link)||await qe(e)}function xe(e){nw.Window.open(e.link,{width:640,height:480},(async function(t){t.on("loaded",(async function(){const o=t.window.document;let n=o.querySelector("#registration_status a.disabled"),i=await(0,p.ZF)('//div[contains(text(),"You aren\'t registered.")]',o);if(console.log(n,i),!a().empty(n)||!a().empty(i)){console.log("修改状态");const t=await(0,m.wv)({id:e.id,status:0});t.code}}))}))}function Ce(e,t){console.log(t.id),g.Z.push("/premint/item/"+t.id)}async function be(e,t){d.T$U.confirm("是否确认删除?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{const e=await(0,m.$l)({params:{id:t.id}});0===e.code?((0,d.z8N)({type:"success",message:"删除成功!"}),await Te()):(0,d.z8N)({type:"error",message:e.message})}))}function _e(){g.Z.push("/premint/item/0")}async function ze(){we.lists=[],we.pagination.page=1,we.pagination.pageSize=15,we.keyword="",await Te()}async function Te(){we.listLoading=!0;const e=await(0,m.kC)({params:{keyword:we.keyword,pageSize:we.pagination.pageSize,page:we.pagination.page,type:pe.value.join(","),my_state:ge.value}});we.listLoading=!1,0===e.code&&(we.lists=e.data.lists,we.pagination.total=e.data.total)}(0,n.ref)("");const Ee=(0,n.ref)(0);async function Be(e){let t=await(0,m.Hy)({twitters:e.twitters,tweet_link:e.like_retweet_link,operators:["like","retweet"]});0===t.code?e.condition.includes("discord")?a().empty(e.discord?.link)||await qe(e):await Se(e):(0,d.z8N)({type:"error",message:t.message})}async function Se(e){return new Promise((async(t,o)=>{if(e?.condition.includes("balance")){console.log("web3",ue);try{let o=await ue.eth.getBalance(r.userInfo.address);if(Ee.value=c().utils.fromWei(o,"ether"),Ee.value<e.balance)return(0,d.z8N)({type:"error",message:`账户余额不足${e.balance}ETH`}),t(!1)}catch(i){(0,d.z8N)({type:"error",message:"检查钱包余额失败，请更换网络"})}}let n=0;nw.Window.open(e.link,{width:640,height:480},(async function(o){o.on("loaded",(async function(){console.log("加载抽奖网页");const l=o.window.document;if(console.log("document.location.href",l.location.href),l.location.href.includes(e.link)||e.link.includes(l.location.href)){let u=l.querySelector("#registration_status a.disabled"),w=await(0,p.ZF)('//div[contains(text(),"You aren\'t registered.")]',l),g=await(0,p.ZF)('//div[contains(text(),"You were not selected!")]',l),f=await(0,p.ZF)('//div[contains(text(),"You were selected!")]',l);if(!a().empty(u)||!a().empty(w)||!a().empty(g)||!a().empty(f)){const n=await(0,m.wv)({id:e.id,status:0});return n.code,a().empty(g)?a().empty(f)?(0,d.z8N)({type:"success",message:`${e.title}不能注册了！`}):(0,d.z8N)({type:"success",message:`${e.title}中奖了！`}):(0,d.z8N)({type:"warning",message:`${e.title}没中奖！`}),o.close(),t(!1)}if(n>1)return(0,d.z8N)({type:"error",message:`${e.title}操作多次，注册失败！`}),o.close(),t(!1);try{await(0,p.sP)(l,"//section//a[contains(text(),'Unregister')]",3e3,!0);let n=await(0,m.oW)({id:e.id});return 0===n.code?(e.register_id=n.data,(0,d.z8N)({type:"success",message:`${e.title}注册成功!`}),o.close(),t(!0)):((0,d.z8N)({type:"error",message:`记录状态失败，${e.title}注册失败!`}),o.close(),t(!1))}catch(c){let u=l.querySelector("form .alert-dismissible");if(!a().empty(u)){let n=u.innerText;try{n=n.replace("×\n",""),e.errorText=n}catch{}return(0,d.z8N)({type:"error",message:`${e.title}注册失败！有任务未完成：${n}。`}),o.close(),t(!1)}try{console.log("开始检查按钮"),await(0,p.sP)(l,"#registration_status button",15e3),console.log("找到了按钮");let t=l.querySelector("#registration_status button");try{l.querySelector("#id_email_field").value=r.userInfo.email}catch{}try{l.querySelector("#id_custom_field").value=e.custom_field}catch{}return n++,t.click(),void console.log("点击了")}catch(s){console.log("loadFormError",s,o);try{console.log("__win.window",o.window),(0,d.z8N)({type:"error",message:`无法检测结果，${e.title}注册失败！`}),o.close()}catch(i){console.log("error",i)}return t(!1)}}}}))}))}))}function Le(){i.value=document.documentElement.clientWidth||document.body.clientWidth}(0,n.ref)(null);const $e=(0,n.ref)(!1),De=(0,n.ref)([]);function Ze(e){De.value=e,$e.value=e.length===we.lists.length,De.value.length<=0&&(we.registerLoading=!1)}function We(){o.refs.table.toggleAllSelection()}async function Ie(){if(Pe.value=!1,a().empty(De.value))(0,d.z8N)({type:"error",message:"你还未选择项目"});else{for(let e of De.value){if(Pe.value)break;we.registerLoading=!0,we.registerLoadingText=`正在注册${e.title}项目`;let o=await(0,m.Hy)({twitters:e.twitters,tweet_link:e.like_retweet_link,operators:["like","retweet"]});if(0===o.code)if(e.condition.includes("discord"))a().empty(e.discord?.link)||await qe(e);else{await Se(e)}else(0,d.z8N)({type:"error",message:o.message});let n=5;const i=setInterval((()=>{we.registerLoadingText=`${n}秒后操作下一个项目`,n<=0?clearInterval(i):n--}),1e3);await t(6e3)}we.registerLoadingText="所选项目操作完成",setTimeout((()=>{we.registerLoading=!1}),2e3)}}async function qe(e){nw.Window.open(e.discord.link,{width:640,height:480},(async function(t){const o=t.window;o&&("WebSocket"in o&&(o.WebSocket={}),console.log("WebSocket support disabled")),t.on("loaded",(async function(){const o=t.window.document;if(console.log("document.location.href",o.location.href),o.location.href.includes(e.discord?.link)||e.discord?.link.includes(o.location.href)||o.location.href.includes("https://discord.com/invite"))try{await(0,p.sP)(o,"//section//div[contains(@class,'pillOnline')]",6e3,!0);let e=o.querySelector("section button");e.click()}catch(n){console.log("找不到接受邀请按钮");try{await(0,p.sP)(o,"//section//div//h3[contains(text(),'Discord')]",6e3,!0);const n=await(0,m.WT)({link:e.discord?.link});if(0===n.code?(console.log("加入服务器了"),(0,d.z8N)({type:"success",message:n.message})):(0,d.z8N)({type:"error",message:n.message}),e.discord?.role){let e=o.querySelector("section button");e.click(),(0,d.z8N)({type:"warning",message:"请继续获取对应角色"})}let i=await Se(e);i&&t.close()}catch(i){console.log("加入服务器失败",i)}}}))}))}async function Fe(e){let t=await(0,m.oW)({id:e.id});0===t.code?(e.register_id=t.data,(0,d.z8N)({type:"success",message:`${e.title}标记注册成功!`})):(0,d.z8N)({type:"error",message:`记录状态失败，${e.title}标记注册失败!`})}const Pe=(0,n.ref)(!1);function Ue(){Pe.value=!0,o.refs.table.toggleAllSelection(),we.registerLoading=!1}return(0,n.onMounted)((async()=>{console.log("onMounted");let e=await ue.eth.getBalance(r.userInfo.address);Ee.value=c().utils.fromWei(e,"ether"),await ze()})),(0,n.onActivated)((()=>{console.log("onActivated"),window.addEventListener("resize",Le)})),(0,n.onDeactivated)((()=>{console.log("onDeactivated"),window.removeEventListener("resize",Le)})),(e,t)=>{const o=(0,n.resolveComponent)("el-icon"),i=(0,n.resolveComponent)("el-button"),a=(0,n.resolveComponent)("el-checkbox"),c=(0,n.resolveComponent)("el-checkbox-group"),s=(0,n.resolveComponent)("el-option"),d=(0,n.resolveComponent)("el-select"),p=(0,n.resolveComponent)("el-input"),m=(0,n.resolveComponent)("el-table-column"),g=(0,n.resolveComponent)("el-table"),ue=(0,n.resolveComponent)("el-pagination"),Te=(0,n.resolveComponent)("el-card"),Se=(0,n.resolveDirective)("loading");return(0,n.openBlock)(),(0,n.createElementBlock)(n.Fragment,null,[(0,n.createVNode)(n.Transition,null,{default:(0,n.withCtx)((()=>[((0,n.openBlock)(),(0,n.createBlock)(n.KeepAlive,null,[(0,n.createVNode)(u.Z)],1024))])),_:1}),(0,n.createVNode)(w.Z,null,{default:(0,n.withCtx)((()=>[(0,n.createElementVNode)("div",f,[k,(0,n.createVNode)(i,{class:"refresh",onClick:ze},{default:(0,n.withCtx)((()=>[(0,n.createVNode)(o,null,{default:(0,n.withCtx)((()=>[(0,n.createVNode)((0,n.unref)(l.hYj))])),_:1})])),_:1})]),(0,n.createVNode)(Te,{shadow:"never"},{default:(0,n.withCtx)((()=>[(0,n.createElementVNode)("div",y,[(0,n.createElementVNode)("div",h,[(0,n.createVNode)(i,{type:"primary",icon:(0,n.unref)(l.v37),onClick:_e},{default:(0,n.withCtx)((()=>[v])),_:1},8,["icon"]),(0,n.createElementVNode)("div",N,[(0,n.createElementVNode)("div",V,[x,(0,n.createVNode)(c,{modelValue:pe.value,"onUpdate:modelValue":t[0]||(t[0]=e=>pe.value=e),onChange:me},{default:(0,n.withCtx)((()=>[(0,n.createVNode)(a,{label:"twitter"},{default:(0,n.withCtx)((()=>[C])),_:1}),(0,n.createVNode)(a,{label:"like_retweet"},{default:(0,n.withCtx)((()=>[b])),_:1}),(0,n.createVNode)(a,{label:"discord"},{default:(0,n.withCtx)((()=>[_])),_:1}),(0,n.createVNode)(a,{label:"balance"},{default:(0,n.withCtx)((()=>[z])),_:1}),(0,n.createVNode)(a,{label:"custom_field"},{default:(0,n.withCtx)((()=>[T])),_:1}),(0,n.createVNode)(a,{label:"other"},{default:(0,n.withCtx)((()=>[E])),_:1})])),_:1},8,["modelValue"])])])]),(0,n.createElementVNode)("div",B,[(0,n.createElementVNode)("div",S,[L,(0,n.createVNode)(d,{class:"width-100",modelValue:ge.value,"onUpdate:modelValue":t[1]||(t[1]=e=>ge.value=e),clearable:"",onChange:fe},{default:(0,n.withCtx)((()=>[(0,n.createVNode)(s,{label:"全部",value:"all"}),(0,n.createVNode)(s,{label:"未注册",value:"not"}),(0,n.createVNode)(s,{label:"已注册",value:"done"}),(0,n.createVNode)(s,{label:"已过期",value:"out"})])),_:1},8,["modelValue"])]),(0,n.createVNode)(p,{modelValue:we.keyword,"onUpdate:modelValue":t[2]||(t[2]=e=>we.keyword=e),style:{width:"200px",float:"right"},placeholder:"请输入关键词","suffix-icon":(0,n.unref)(l.olm),onInput:ye},null,8,["modelValue","suffix-icon"])])]),(0,n.withDirectives)(((0,n.openBlock)(),(0,n.createBlock)(g,{ref:"table","element-loading-text":"正在加载……",data:we.lists,"row-key":"id",style:{width:"100%"},onSelectionChange:Ze},{default:(0,n.withCtx)((()=>[(0,n.createVNode)(m,{prop:"id",type:"selection",width:(0,n.unref)(ke)(50)},null,8,["width"]),(0,n.createVNode)(m,{prop:"title",label:"标题",width:(0,n.unref)(ke)(200)},{default:(0,n.withCtx)((e=>[(0,n.createTextVNode)((0,n.toDisplayString)(e.row.title)+" ",1),e.row.errorText?((0,n.openBlock)(),(0,n.createElementBlock)("div",$,(0,n.toDisplayString)(e.row.errorText),1)):(0,n.createCommentVNode)("",!0)])),_:1},8,["width"]),(0,n.createVNode)(m,{prop:"winners",label:"奖品数量",width:(0,n.unref)(ke)(100)},null,8,["width"]),(0,n.createVNode)(m,{prop:"followers",label:"推特粉丝",width:(0,n.unref)(ke)(100)},null,8,["width"]),(0,n.createVNode)(m,{label:"抽奖条件",width:(0,n.unref)(ke)(260)},{default:(0,n.withCtx)((e=>[e.row.twitters.length>0?((0,n.openBlock)(),(0,n.createElementBlock)("div",D,[Z,((0,n.openBlock)(!0),(0,n.createElementBlock)(n.Fragment,null,(0,n.renderList)(e.row.new_twitters,((e,t)=>((0,n.openBlock)(),(0,n.createElementBlock)("div",{key:t,class:(0,n.normalizeClass)(["view",{active:e.followed}]),onClick:t=>Ne(e.link)},(0,n.toDisplayString)(e.link),11,W)))),128))])):(0,n.createCommentVNode)("",!0),e.row.like_retweet_link?((0,n.openBlock)(),(0,n.createElementBlock)("div",I,[q,(0,n.createElementVNode)("div",{class:(0,n.normalizeClass)(["view",{active:e.row.like_retweet_link_liked&&e.row.like_retweet_link_retweeted}]),onClick:t=>Ne(e.row.like_retweet_link)},(0,n.toDisplayString)(e.row.like_retweet_link),11,F)])):(0,n.createCommentVNode)("",!0),e.row.discord?.link?((0,n.openBlock)(),(0,n.createElementBlock)("div",P,[U,(0,n.createElementVNode)("div",null,[(0,n.createElementVNode)("div",{class:(0,n.normalizeClass)(["view",{active:e.row.discord_joined}]),onClick:t=>Ve(e.row)},(0,n.toDisplayString)(e.row.discord?.link),11,A),e.row.discord?.role?((0,n.openBlock)(),(0,n.createElementBlock)("span",H," 获得"+(0,n.toDisplayString)(e.row.discord?.role)+" role",1)):(0,n.createCommentVNode)("",!0)])])):(0,n.createCommentVNode)("",!0),e.row.balance?((0,n.openBlock)(),(0,n.createElementBlock)("div",Y,[j,(0,n.createElementVNode)("div",{class:(0,n.normalizeClass)({active:Ee.value>=e.row.balance,error:Ee.value<e.row.balance})},(0,n.toDisplayString)(e.row.balance)+" ETH ",3)])):(0,n.createCommentVNode)("",!0),e.row.other?((0,n.openBlock)(),(0,n.createElementBlock)("div",M,[K,(0,n.createElementVNode)("div",null,(0,n.toDisplayString)(e.row.other),1)])):(0,n.createCommentVNode)("",!0)])),_:1},8,["width"]),(0,n.createVNode)(m,{prop:"description",label:"抽奖描述",width:(0,n.unref)(ke)(250)},null,8,["width"]),(0,n.createVNode)(m,{label:"状态",width:(0,n.unref)(ke)(120)},{default:(0,n.withCtx)((e=>[e.row.register_id?((0,n.openBlock)(),(0,n.createBlock)(i,{key:0,type:"success",text:""},{default:(0,n.withCtx)((()=>[O])),_:1})):((0,n.openBlock)(),(0,n.createBlock)(i,{key:1,type:"warning",text:""},{default:(0,n.withCtx)((()=>[R])),_:1}))])),_:1},8,["width"]),(0,n.createVNode)(m,{label:"操作",width:(0,n.unref)(ke)(360)},{default:(0,n.withCtx)((e=>[(0,n.createVNode)(i,{size:"small",type:"primary",onClick:t=>xe(e.row)},{default:(0,n.withCtx)((()=>[G])),_:2},1032,["onClick"]),(0,n.createVNode)(i,{size:"small",type:"success",onClick:t=>Be(e.row)},{default:(0,n.withCtx)((()=>[J])),_:2},1032,["onClick"]),(0,n.unref)(r).userInfo.id==e.row.uid?((0,n.openBlock)(),(0,n.createElementBlock)(n.Fragment,{key:0},[(0,n.createVNode)(i,{size:"small",type:"default",icon:(0,n.unref)(l.I8b),onClick:t=>Ce(e.$index,e.row)},{default:(0,n.withCtx)((()=>[Q])),_:2},1032,["icon","onClick"]),(0,n.createVNode)(i,{size:"small",type:"danger",onClick:t=>be(e.$index,e.row)},{default:(0,n.withCtx)((()=>[X])),_:2},1032,["onClick"])],64)):(0,n.createCommentVNode)("",!0),(0,n.createVNode)(i,{size:"small",type:"warning",onClick:t=>Fe(e.row)},{default:(0,n.withCtx)((()=>[ee])),_:2},1032,["onClick"])])),_:1},8,["width"])])),_:1},8,["data"])),[[Se,we.listLoading]]),(0,n.createElementVNode)("div",te,[(0,n.createElementVNode)("div",oe,[(0,n.createVNode)(a,{modelValue:$e.value,"onUpdate:modelValue":t[3]||(t[3]=e=>$e.value=e),border:"",style:{border:"0"},onChange:We},{default:(0,n.withCtx)((()=>[ne])),_:1},8,["modelValue"]),(0,n.createVNode)(i,{type:"success",onClick:Ie},{default:(0,n.withCtx)((()=>[ie])),_:1})]),(0,n.createElementVNode)("div",ae,[(0,n.createVNode)(ue,{size:"small","current-page":we.pagination.page,"page-sizes":[15,30,50],"page-size":we.pagination.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:we.pagination.total,onSizeChange:he,onCurrentChange:ve},null,8,["current-page","page-size","total"])])])])),_:1}),(0,n.withDirectives)((0,n.createElementVNode)("div",le,[(0,n.createElementVNode)("div",re,[ce,(0,n.createElementVNode)("p",se,(0,n.toDisplayString)(we.registerLoadingText),1),(0,n.createVNode)(i,{class:"quit-btn",type:"warning",onClick:Ue},{default:(0,n.withCtx)((()=>[de])),_:1})])],512),[[n.vShow,we.registerLoading]])])),_:1})],64)}}});const we=ue;var pe=we}}]);